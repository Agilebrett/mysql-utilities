<?xml version="1.0" encoding="utf-8"?>
<Wix xmlns='http://schemas.microsoft.com/wix/2006/wi'
  xmlns:util='http://schemas.microsoft.com/wix/UtilExtension'>
  <Product Id="*"
   Name="$(var.ProductName)"
   Version="$(var.Version)"
   Manufacturer="Oracle"
   Language="1033"
   UpgradeCode="$(var.UpgradeCode)">

    <Package Compressed="yes" InstallerVersion="200"
     Description="$(var.ProductName) Installer"
     Comments="$(var.Copyright)"
     InstallScope="perMachine"/>

    <MajorUpgrade AllowDowngrades="no" Disallow="no"
     DowngradeErrorMessage="A later version of $(var.ProductName) is already installed."/>

    <Media Id="1" Cabinet="ConnectorPython_Python.cab" EmbedCab="yes"/>

    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFilesFolder" Name="ProgFilesFolder">
        <Directory Id="CompanyDir" Name="MySQL">
          <Directory Id="INSTALLDIR" Name="$(var.ProductName)"/>
        </Directory>
      </Directory>
      <Directory Id="ProgramMenuFolder" Name="Programs">
        <Directory Id="CompanyMenu" Name="MySQL">
          <Directory Id="UtilsMenu" Name="MySQL Utilities">
            <Directory Id="DocMenu" Name="Documentation"/>
          </Directory>
        </Directory>
      </Directory>
    </Directory>

    <DirectoryRef Id="CompanyMenu">
      <Component Id="CompanyMenuComponent" Guid="c97ca399-7d02-4b9c-9a96-7783c33c8f24">
       <RemoveFolder Id="CompanyMenu" On="uninstall"/>
       <RegistryKey Root="HKCU"
        Key="Software\MySQL\MySQL Utilities"
        Action="createAndRemoveOnUninstall">
         <RegistryValue Type="string" Name="Version" Value="$(var.Version)"
          KeyPath="yes"/>
         <RegistryValue Type="string" Name="Location" Value="[INSTALLDIR]"/>
       </RegistryKey>
       <RegistryKey Root="HKCU"
        Key="Software\MySQL AB\MySQL Utilities"
        Action="createAndRemoveOnUninstall">
         <RegistryValue Type="string" Name="Version" Value="$(var.Version)"/>
         <RegistryValue Type="string" Name="Location" Value="[INSTALLDIR]"/>
       </RegistryKey>
      </Component>
    </DirectoryRef>

    <DirectoryRef Id="INSTALLDIR">
      <Component Id="SetupRegistry" Guid="ab4f2462-3dd8-4e7d-ad31-f81a652ef1fb">
        <RegistryKey Root="HKCU"
         Key="Software\MySQL\MySQL Utilities"
         Action="createAndRemoveOnUninstall">
          <RegistryValue Type="string" Name="Version" Value="$(var.Version)"
           KeyPath="yes"/>
          <RegistryValue Type="string" Name="Location" Value="[INSTALLDIR]"/>
        </RegistryKey>
        <RegistryKey Root="HKCU"
         Key="Software\MySQL AB\MySQL Utilities"
         Action="createAndRemoveOnUninstall">
          <RegistryValue Type="string" Name="Version" Value="$(var.Version)"/>
          <RegistryValue Type="string" Name="Location" Value="[INSTALLDIR]"/>
        </RegistryKey>
      </Component>
      <Component Id="SetupEnv" Guid="b692b935-6205-4fff-b9d0-a88eb66295aa">
        <CreateFolder/>
        <Environment Id="SystemPath" Name="PATH"
         Action="set" Value="[INSTALLDIR]"
         Part="last" System="yes" Permanent="no"/>
      </Component>
      <Component Id="UtilsExe" Guid="ad3556a3-1c3c-4b9e-916f-f00792649bab">
        <File Id="exe_mysqlauditadmin" Name="mysqlauditadmin.exe"
         Source="$(var.BuildDir)\mysqlauditadmin.exe" DiskId="1"/>
        <File Id="exe_mysqlauditgrep" Name="mysqlauditgrep.exe"
         Source="$(var.BuildDir)\mysqlauditgrep.exe" DiskId="1"/>
        <File Id="exe_mysqldbcompare" Name="mysqldbcompare.exe"
         Source="$(var.BuildDir)\mysqldbcompare.exe" DiskId="1"/>
        <File Id="exe_mysqldbcopy" Name="mysqldbcopy.exe"
         Source="$(var.BuildDir)\mysqldbcopy.exe" DiskId="1"/>
        <File Id="exe_mysqldbexport" Name="mysqldbexport.exe"
         Source="$(var.BuildDir)\mysqldbexport.exe" DiskId="1"/>
        <File Id="exe_mysqldbimport" Name="mysqldbimport.exe"
         Source="$(var.BuildDir)\mysqldbimport.exe" DiskId="1"/>
        <File Id="exe_mysqldiff" Name="mysqldiff.exe"
         Source="$(var.BuildDir)\mysqldiff.exe" DiskId="1"/>
        <File Id="exe_mysqldiskusage" Name="mysqldiskusage.exe"
         Source="$(var.BuildDir)\mysqldiskusage.exe" DiskId="1"/>
        <File Id="exe_mysqlfailover" Name="mysqlfailover.exe"
         Source="$(var.BuildDir)\mysqlfailover.exe" DiskId="1"/>
        <File Id="exe_mysqlfrm" Name="mysqlfrm.exe"
         Source="$(var.BuildDir)\mysqlfrm.exe" DiskId="1"/>
        <File Id="exe_mysqlindexcheck" Name="mysqlindexcheck.exe"
         Source="$(var.BuildDir)\mysqlindexcheck.exe" DiskId="1"/>
        <File Id="exe_mysqlmetagrep" Name="mysqlmetagrep.exe"
         Source="$(var.BuildDir)\mysqlmetagrep.exe" DiskId="1"/>
        <File Id="exe_mysqlprocgrep" Name="mysqlprocgrep.exe"
         Source="$(var.BuildDir)\mysqlprocgrep.exe" DiskId="1"/>
        <File Id="exe_mysqlreplicate" Name="mysqlreplicate.exe"
         Source="$(var.BuildDir)\mysqlreplicate.exe" DiskId="1"/>
        <File Id="exe_mysqlrpladmin" Name="mysqlrpladmin.exe"
         Source="$(var.BuildDir)\mysqlrpladmin.exe" DiskId="1"/>
        <File Id="exe_mysqlrplcheck" Name="mysqlrplcheck.exe"
         Source="$(var.BuildDir)\mysqlrplcheck.exe" DiskId="1"/>
        <File Id="exe_mysqlrplshow" Name="mysqlrplshow.exe"
         Source="$(var.BuildDir)\mysqlrplshow.exe" DiskId="1"/>
        <File Id="exe_mysqlserverclone" Name="mysqlserverclone.exe"
         Source="$(var.BuildDir)\mysqlserverclone.exe" DiskId="1"/>
        <File Id="exe_mysqlserverinfo" Name="mysqlserverinfo.exe"
         Source="$(var.BuildDir)\mysqlserverinfo.exe" DiskId="1"/>
        <File Id="exe_mysqluc" Name="mysqluc.exe"
         Source="$(var.BuildDir)\mysqluc.exe" DiskId="1"/>
        <File Id="exe_mysqluserclone" Name="mysqluserclone.exe"
         Source="$(var.BuildDir)\mysqluserclone.exe" DiskId="1"/>
      </Component>
      <Component Id="UtilsDLL" Guid="2804c1fa-f8df-484a-9a56-47bbe82bff79">
        <File Id="dll_python" Name="python$(var.PythonMajor)$(var.PythonMinor).dll"
         Source="$(var.BuildDir)\python$(var.PythonMajor)$(var.PythonMinor).dll" DiskId="1"/>
      </Component>
      <Component Id="UtilsPYD" Guid="a657a7e5-07df-4de1-bf9e-4ae575fe8585">
        <File Id="pyd_bz2" Name="bz2.pyd"
         Source="$(var.BuildDir)\bz2.pyd" DiskId="1"/>
        <File Id="pyd_pyexpat" Name="pyexpat.pyd"
         Source="$(var.BuildDir)\pyexpat.pyd" DiskId="1"/>
        <File Id="pyd_select" Name="select.pyd"
         Source="$(var.BuildDir)\select.pyd" DiskId="1"/>
        <File Id="pyd_unicodedata" Name="unicodedata.pyd"
         Source="$(var.BuildDir)\unicodedata.pyd" DiskId="1"/>
        <File Id="pyd__ctypes" Name="_ctypes.pyd"
         Source="$(var.BuildDir)\_ctypes.pyd" DiskId="1"/>
        <File Id="pyd__hashlib" Name="_hashlib.pyd"
         Source="$(var.BuildDir)\_hashlib.pyd" DiskId="1"/>
        <File Id="pyd__multiprocessing" Name="_multiprocessing.pyd"
         Source="$(var.BuildDir)\_multiprocessing.pyd" DiskId="1"/>
        <File Id="pyd__socket" Name="_socket.pyd"
         Source="$(var.BuildDir)\_socket.pyd" DiskId="1"/>
        <File Id="pyd__ssl" Name="_ssl.pyd"
         Source="$(var.BuildDir)\_ssl.pyd" DiskId="1"/>
      </Component>

      <Component Id="UtilsPyLib" Guid="dbc3ab31-937d-452d-993f-7130c75188ac">
        <File Id="zip_library" Name="library.zip"
         Source="$(var.BuildDir)\library.zip" DiskId="1"/>
      </Component>

      <Component Id="UtilsDocs" Guid="68608e06-d064-4909-9e3e-a60bd6f3f09b">
        <File Id="README" Name="README.txt"
         Source="$(var.BuildDir)\README.txt" DiskId="1"/>
        <File Id="LICENSE" Name="LICENSE.txt"
         Source="$(var.BuildDir)\LICENSE.txt" DiskId="1"/>
      </Component>

    </DirectoryRef>

    <DirectoryRef Id="UtilsMenu">
      <Component Id="UtilsShortcuts" Guid="6eb1d27b-7be1-41da-a3e2-616b3494c1dc">
        <RemoveFolder Id="UtilsMenu" On="uninstall"/>
        <RegistryKey Root="HKCU"    
         Key="Software\MySQL\MySQL Utilities"
         Action="createAndRemoveOnUninstall">
          <RegistryValue Type="string" Name="Version" Value="$(var.Version)"
           KeyPath="yes"/>
          <RegistryValue Type="string" Name="Location" Value="[INSTALLDIR]"/>
        </RegistryKey>
        <RegistryKey Root="HKCU"
         Key="Software\MySQL AB\MySQL Utilities"
         Action="createAndRemoveOnUninstall">
          <RegistryValue Type="string" Name="Version" Value="$(var.Version)"/>
          <RegistryValue Type="string" Name="Location" Value="[INSTALLDIR]"/>
        </RegistryKey>
        <Shortcut Id="exec_mysqluc"
                  Name="MySQL Utilities Console"
                  Description="MySQL Utilities Console"
                  Target="[INSTALLDIR]mysqluc.exe"
                  WorkingDirectory="INSTALLDIR"/>
      </Component>
    </DirectoryRef>

    <DirectoryRef Id="DocMenu">
      <Component Id="UtilsManuals" Guid="0ee2012b-0f38-45e1-9b62-a18ec82879a4">
        <RemoveFolder Id="DocMenu" On="uninstall"/>
        <RegistryKey Root="HKCU"
         Key="Software\MySQL\MySQL Utilities"
         Action="createAndRemoveOnUninstall">
          <RegistryValue Type="string" Name="Version" Value="$(var.Version)"
           KeyPath="yes"/>
          <RegistryValue Type="string" Name="Location" Value="[INSTALLDIR]"/>
        </RegistryKey>
        <RegistryKey Root="HKCU"
         Key="Software\MySQL AB\MySQL Utilities"
         Action="createAndRemoveOnUninstall">
          <RegistryValue Type="string" Name="Version" Value="$(var.Version)"/>
          <RegistryValue Type="string" Name="Location" Value="[INSTALLDIR]"/>
        </RegistryKey>
        <util:InternetShortcut Id="url_workbench"
         Name="MySQL Workbench Manual (online)"
         Target="http://dev.mysql.com/doc/workbench/en/index.html"/>
        <util:InternetShortcut Id="url_mysqlauditadmin"
         Name="mysqlauditadmin (online)"
         Target="http://dev.mysql.com/doc/workbench/en/mysqlauditadmin.html"/>
        <util:InternetShortcut Id="url_mysqlauditgrep"
         Name="mysqlauditgrep (online)"
         Target="http://dev.mysql.com/doc/workbench/en/mysqlauditgrep.html"/>
        <util:InternetShortcut Id="url_mysqldbcompare"
         Name="mysqldbcompare (online)"
         Target="http://dev.mysql.com/doc/workbench/en/mysqldbcompare.html"/>
        <util:InternetShortcut Id="url_mysqldbcopy"
         Name="mysqldbcopy (online)"
         Target="http://dev.mysql.com/doc/workbench/en/mysqldbcopy.html"/>
        <util:InternetShortcut Id="url_mysqldbexport"
         Name="mysqldbexport (online)"
         Target="http://dev.mysql.com/doc/workbench/en/mysqldbexport.html"/>
        <util:InternetShortcut Id="url_mysqldbimport"
         Name="mysqldbimport (online)"
         Target="http://dev.mysql.com/doc/workbench/en/mysqldbimport.html"/>
        <util:InternetShortcut Id="url_mysqldiff"
         Name="mysqldiff (online)"
         Target="http://dev.mysql.com/doc/workbench/en/mysqldiff.html"/>
        <util:InternetShortcut Id="url_mysqldiskusage"
         Name="mysqldiskusage (online)"
         Target="http://dev.mysql.com/doc/workbench/en/mysqldiskusage.html"/>
        <util:InternetShortcut Id="url_mysqlfailover"
         Name="mysqlfailover (online)"
         Target="http://dev.mysql.com/doc/workbench/en/mysqlfailover.html"/>
        <util:InternetShortcut Id="url_mysqlindexcheck"
         Name="mysqlindexcheck (online)"
         Target="http://dev.mysql.com/doc/workbench/en/mysqlindexcheck.html"/>
        <util:InternetShortcut Id="url_mysqlmedagrep"
         Name="mysqlmetagrep (online)"
         Target="http://dev.mysql.com/doc/workbench/en/mysqlmetagrep.html"/>
        <util:InternetShortcut Id="url_mysqlprocgrep"
         Name="mysqlprocgrep (online)"
         Target="http://dev.mysql.com/doc/workbench/en/mysqlprocgrep.html"/>
        <util:InternetShortcut Id="url_mysqlreplicate"
         Name="mysqlreplicate (online)"
         Target="http://dev.mysql.com/doc/workbench/en/mysqlreplicate.html"/>
        <util:InternetShortcut Id="url_mysqlrpladmin"
         Name="mysqlrepladmin (online)"
         Target="http://dev.mysql.com/doc/workbench/en/mysqlrpladmin.html"/>
        <util:InternetShortcut Id="url_mysqlrplcheck"
         Name="mysqlrplcheck (online)"
         Target="http://dev.mysql.com/doc/workbench/en/mysqlrplcheck.html"/>
        <util:InternetShortcut Id="url_mysqlrplshow"
         Name="mysqlrplshow (online)"
         Target="http://dev.mysql.com/doc/workbench/en/mysqlrplshow.html"/>
        <util:InternetShortcut Id="url_mysqlserverclone"
         Name="mysqlserverclone (online)"
         Target="http://dev.mysql.com/doc/workbench/en/mysqlserverclone.html"/>
        <util:InternetShortcut Id="url_mysqlserverinfo"
         Name="mysqlserverinfo (online)"
         Target="http://dev.mysql.com/doc/workbench/en/mysqlserverinfo.html"/>
        <util:InternetShortcut Id="url_mysqluc"
         Name="mysqluc (online)"
         Target="http://dev.mysql.com/doc/workbench/en/mysqluc.html"/>
        <util:InternetShortcut Id="url_mysqluserclone"
         Name="mysqluserclone (online)"
         Target="http://dev.mysql.com/doc/workbench/en/mysqluserclone.html"/>
      </Component>
    </DirectoryRef>

    <Feature Id="Complete" Level="1" ConfigurableDirectory="INSTALLDIR"
      Title="$(var.ProductName) $(var.Version)" Description="Complete">
      <Feature Id="Install" Level="1">
        <ComponentRef Id="SetupRegistry"/>
        <ComponentRef Id="SetupEnv"/>
        <ComponentRef Id="UtilsExe"/>
        <ComponentRef Id="UtilsDLL"/>
        <ComponentRef Id="UtilsPYD"/>
        <ComponentRef Id="UtilsPyLib"/>
        <ComponentRef Id="UtilsDocs"/>
        <ComponentRef Id="UtilsManuals"/>
        <ComponentRef Id="UtilsShortcuts"/>
        <ComponentRef Id="CompanyMenuComponent"/>
      </Feature>
    </Feature>

    <InstallExecuteSequence>
      <!--<RemoveExistingProducts After="InstallInitialize"/>-->
    </InstallExecuteSequence>

    <!-- Launch mysqluc after installation -->
    <Property Id="WIXUI_EXITDIALOGOPTIONALTEXT" Value="!(loc.ExitDialogOptionalText)"/>
    <Property Id="WIXUI_EXITDIALOGOPTIONALCHECKBOX" Value="0"/>
    <Property Id="WIXUI_EXITDIALOGOPTIONALCHECKBOXTEXT"
     Value="Launch MySQL Utilities Console"/>
    <CustomAction Id="LaunchApplication" Directory="INSTALLDIR"
     ExeCommand="[SystemFolder]cmd.exe /C start mysqluc.exe" />

    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLDIR"/>
    <UI>
      <UIRef Id="WixUI_InstallDir"/>
      <Publish Dialog="WelcomeDlg" Control="Next" Event="NewDialog"
       Value="InstallDirDlg" Order="2">1</Publish>
      <Publish Dialog="InstallDirDlg" Control="Back" Event="NewDialog"
       Value="WelcomeDlg" Order="2">1</Publish>
      <Publish Dialog="ExitDialog" Control="Finish" Event="DoAction" 
       Value="LaunchApplication">WIXUI_EXITDIALOGOPTIONALCHECKBOX = 1 and NOT Installed</Publish>
    </UI>
    <WixVariable Id="WixUIBannerBmp"
     Value="$(var.BitmapDir)\WixUIBanner_Utilities.bmp"/>
    <WixVariable Id="WixUIDialogBmp"
     Value="$(var.BitmapDir)\WixUIDialog_Utilities.bmp"/>

    <Property Id="Version" Value="$(var.Version)"/>
    <Property Id="WorkbenchReleaseNotice" Value="$(var.ReleaseString)"/>
  </Product>
</Wix>
